 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>حاسبة تكلفة بناء منزل مع أسعار المواد الحالية</title>
 <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>





  <style>
    .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    
	
	.tooltip-container {
  position: relative;
  display: inline-block; /* أو block حسب الحاجة */
  width: 100%; /* أو حجم مناسب */
}
.tooltip-text {
  visibility: hidden;
  max-width: 300px;
  background-color: #004080;
  color: #fff;
  text-align: center;
  padding: 6px 10px;
  border-radius: 6px;
  position: absolute;
  bottom: 125%; /* فوق العنصر */
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  white-space: normal;
  font-size: 14px;
  line-height: 1.3;
  opacity: 0;
  transition: opacity 0.3s ease;
}
.tooltip-container:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
.tooltip-text::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -6px;
  border-width: 6px;
  border-style: solid;
  border-color: #004080 transparent transparent transparent;
}

    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Amiri', 'Noto Sans Arabic', Tahoma, sans-serif;
      background: #f4e7d3 url('https://www.transparenttextures.com/patterns/arabesque.png') repeat;
      direction: rtl;
      overflow-x: hidden;
      color: #3c2f2f;
    }
    .container {
      width: 100%;
      max-width: 1000px;
      margin: 0 auto;
      background: #fffcf7;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      box-sizing: border-box;
      min-height: 100%;
      border: 3px solid #d4a373;
    }
    h2, h3 {
      color: #004aad;
      margin: 15px 0;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      position: relative;
    }
    h2::after, h3::after {
      content: '';
      display: block;
      width: 100px;
      height: 4px;
      background: linear-gradient(to left, #d4a373, #004aad);
      margin: 10px auto;
      border-radius: 2px;
    }
    label {
      font-weight: bold;
      color: #3c2f2f;
      display: block;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      box-sizing: border-box;
      font-size: 16px;
      min-height: 48px;
      border: 2px solid #d4a373;
      border-radius: 8px;
      background: #fff;
      color: #3c2f2f;
    }
    button {
      background: linear-gradient(45deg, #004aad, #007bff);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: transform 0.2s, background 0.3s;
    }
    button:hover {
      background: linear-gradient(45deg, #003087, #005bb5);
      transform: scale(1.02);
    }
    .table-responsive {
      overflow-x: auto;
      margin-top: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      background: #fffcf7;
      border: 2px solid #d4a373;
    }
    th, td {
      border: 1px solid #d4a373;
      padding: 10px;
      text-align: center;
      color: #3c2f2f;
    }
    th {
      background: linear-gradient(to bottom, #004aad, #007bff);
      color: white;
      font-weight: bold;
    }
    .section-title {
      background: #e8f5e9;
      font-weight: bold;
      font-size: 18px;
      color: #2e7d32;
      padding: 10px;
      border-radius: 8px;
      margin-top: 20px;
      border: 2px solid #d4a373;
      position: relative;
      overflow: hidden;
    }
    .section-title::before {
      content: '◇◆◇';
      position: absolute;
      top: 50%;
      left: 10px;
      transform: translateY(-50%);
      color: #d4a373;
      opacity: 0.3;
    }
    .floor-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      direction: rtl;
      font-size: 16px;
      margin-bottom: 10px;
      gap: 10px;
      flex-wrap: wrap;
      background: #fff3cd;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #d4a373;
    }
    .left {
      text-align: left;
      direction: ltr;
      flex: 1;
      color: #28a745;
      font-weight: bold;
    }
    .center {
      flex: 2;
      text-align: center;
      font-weight: normal;
    }
    .right {
      text-align: right;
      flex: 1;
    }
    .price-color {
      color: #007bff;
      font-size: 22px;
      font-weight: bold;
    }
    .meter-color {
      font-weight: bold;
      font-size: 22px;
    }
    .final-total {
      background: #ffebee;
      font-weight: bold;
      font-size: 20px;
      color: #c62828;
      padding: 15px;
      margin-top: 25px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid #d4a373;
    }
    .house-type {
      background: #ede7f6;
      color: #512da8;
      font-weight: bold;
      padding: 12px;
      margin: 15px 0;
      border-radius: 10px;
      text-align: center;
      border: 2px solid #d4a373;
    }
    input.unit-price-input, input.base-qty-input {
      width: 80px;
      padding: 6px;
      font-size: 14px;
      border: 1px solid #d4a373;
      border-radius: 6px;
      text-align: center;
    }
    table[border="1"] {
      width: 100%;
      max-width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      font-family: 'Amiri', 'Noto Sans Arabic', Arial, sans-serif;
      background: #fffcf7;
      border: 2px solid #d4a373;
    }
    button[onclick="exportTablesToExcel()"] {
      background-color: #B4462F;
      color: #F5E8D3;
      font-size: 18px;
      font-family: 'Cinzel', serif;
      padding: 14px 24px;
      border: 2px solid #D4A017;
      border-radius: 12px;
      cursor: pointer;
      display: block;
      margin: 20px auto;
      text-align: center;
      direction: rtl;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
    }
    button[onclick="exportTablesToExcel()"]:hover {
      background-color: #2E8B57;
      transform: scale(1.05);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }
    @media only screen and (max-width: 600px) {
      body {
        padding: 5px;
      }
      .container {
        padding: 10px;
      }
      h2, h3 {
        font-size: 16px;
      }
      table {
        font-size: 13px;
      }
      th, td {
        padding: 6px;
      }
      input.unit-price-input, input.base-qty-input {
        width: 60px;
        font-size: 12px;
      }
      button {
        font-size: 14px;
        padding: 10px;
      }
      table[border="1"] {
        max-width: 100%;
      }
      .section-title, .floor-total, .final-total, .house-type {
        font-size: 14px;
        padding: 8px;
      }
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-6 max-w-4xl">
    <h1 class="text-3xl font-bold text-center mb-4 text-blue-800">حاسبة تكلفة بناء منزل مع أسعار المواد الحالية</h1>

    <!-- Input Form -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
	
   <div style="background-color:#f0f8ff; border: 2px solid #4a90e2; padding: 15px; border-radius: 8px; font-family: 'Arial', sans-serif; color: #333; max-width: 800px; line-height: 1.5; margin: 50px auto; text-align: center;">
  <p style="font-size: 18px; margin: 0; display: inline-block; text-align: right;">
    <span style="color: #e67e22; font-weight: bold;">📌</span> يمكنك تعديل <strong>المساحة</strong> وعدد <strong>الطوابق</strong> حسب مشروعك، ثم الضغط على 
    <span style="background-color: #4a90e2; color: white; padding: 3px 8px; border-radius: 4px; font-weight: bold;">احسب التكلفة</span> 
    للحصول على تقدير تقريبي يوضح فكرة عامة عن التكلفة. يمكنك أيضاً طباعة النتائج بصيغتي <strong>PDF</strong> أو <strong>Excel</strong> للاحتفاظ بها.
  </p>
   </div>
	
	
	
	
    <div id="errorMessage" class="text-red-600 mb-4 hidden"></div>

      <!-- Dimensions Section -->
      <h3 class="text-lg font-semibold mb-3 text-blue-600">الأبعاد</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
          <label class="block text-sm font-medium" for="buildLength">طول المبنى (متر):</label>
          <input id="buildLength" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="10" placeholder="مثال: 10" aria-label="طول المبنى بالمتر">
        </div>
        <div>
          <label class="block text-sm font-medium" for="buildWidth">عرض المبنى (متر):</label>
          <input id="buildWidth" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="12" placeholder="مثال: 12" aria-label="عرض المبنى بالمتر">
        </div>
		
		      <div>
          <label class="block text-sm font-medium" for="landLength">  </label>
          <input id="landLength" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="10" placeholder="مثال: 10" aria-label="طول الأرض بالمتر"  style="display: none;" >
        </div>
        <div>
          <label class="block text-sm font-medium" for="landWidth"> </label>
          <input id="landWidth" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="12" placeholder="مثال: 12" aria-label="عرض الأرض بالمتر"  style="display: none;">
        </div>

        <div>
          <label class="block text-sm font-medium" for="numFloors">عدد الطوابق (بدون السطح):</label>
          <input id="numFloors" type="number" min="1" step="1" class="mt-1 p-2 w-full border rounded" value="2" placeholder="2ثال: 1" aria-label="عدد الطوابق">
        </div>
        

		

<div>
  <label class="block text-lg font-medium" for="hasBasement" style="color: blue;">
    هل يوجد قبو ؟ (La cave)
  </label>
  <small style="color: gray;">إذا كان لديك قبو، ضع علامة هنا</small><br>
  <input 
    id="hasBasement" 
    type="checkbox" 
    style="width: 16px; height: 16px;"
    aria-label="إضافة قبو"
  >
</div>



	
        <div>
          <label class="block text-sm font-medium" for="semelleCount">
		  
		عدد السملات (Semelle) — القاعدة
		  
		  </label>
          <input id="semelleCount" type="number" min="1" step="1" class="mt-1 p-2 w-full border rounded" value="16" placeholder="مثال: 16" aria-label="عدد السملات">
        </div>
      </div>
	  

      <!-- Material Prices Section -->
      
	<h3 class="text-lg font-semibold mt-6 mb-3 text-blue-600">
  أسعار مواد البناء الخاصة بالأشغال الكبرى (gros œuvre)، وفق الأسعار الحالية. يمكنكم تعديلها عند تغيّر الأسعار.
</h3>

	  
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium" for="betonPrice">سعر البيتون (درهم مغربي/م³):</label>
          <input id="betonPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="850" placeholder="مثال: 850" aria-label="سعر البيتون لكل متر مكعب">
        </div>
        <div>
          <label class="block text-sm font-medium" for="b15Price">سعر خرسانة النظافة B15 (درهم مغربي/م³):</label>
          <input id="b15Price" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="850" placeholder="مثال: 850" aria-label="سعر خرسانة النظافة B15">
        </div>
        <div>
          <label class="block text-sm font-medium" for="ironPrice">سعر الحديد (درهم مغربي/كجم):</label>
          <input id="ironPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="9.5" placeholder="مثال: 9.5" aria-label="سعر الحديد لكل كيلوغرام">
        </div>
        <div>
          <label class="block text-sm font-medium" for="cementPrice">سعر الأسمنت (درهم مغربي/خنشة):</label>
          <input id="cementPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="82" placeholder="مثال: 82" aria-label="سعر الأسمنت لكل خنشة">
        </div>
        <div>
          <label class="block text-sm font-medium" for="excavationPrice">سعر الحفر (درهم مغربي/م³):</label>
          <input id="excavationPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="35" placeholder="مثال: 35" aria-label="سعر الحفر لكل متر مكعب">
        </div>
		

        
		
<div class="tooltip-container">
  <label for="gravelPrice" class="block text-sm font-medium">سعر حصى الفياج (درهم مغربي/م³):</label>
  <input 
    id="gravelPrice" 
    type="number" 
    min="0" 
    step="0.1" 
    value="148" 
    placeholder="مثال: 148" 
    aria-label="سعر حصى الفياج"
    class="mt-1 p-2 w-full border rounded"
  >
  <div class="tooltip-text" style="
    background-color: #004080;
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    margin-top: 5px;
    font-size: 14px;
  ">
    التغطية (فياج) التي تساوي 25 م³ تكلف 3700 درهم، أي 148 درهم للمتر المكعب .
  </div>
</div>

		
		
		<div>
          <label class="block text-sm font-medium" for="brickPrice">سعر الطوب (درهم مغربي/حبة):</label>
          <input id="brickPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="6.5" placeholder="مثال: 6.5" aria-label="سعر الطوب لكل حبة">
        </div>
		
		
		


<div class="tooltip-container">
  <label for="sandPrice" class="block text-sm font-medium">سعر رمل البناء (درهم مغربي/م³):</label>
  <input 
    id="sandPrice" 
    type="number" 
    min="0" 
    step="0.1" 
    value="240" 
    placeholder="مثال: 240" 
    aria-label="سعر رمل البناء"
  >
  <div class="tooltip-text">
    كمية 25 م² تكلف 6000 درهم، والتغطية (فياج) هي 240 درهم للمتر المكعب.
  </div>
</div>


		
         
		
				<div>
          <label class="block text-sm font-medium" for="aggregatePrice">سعر الحصى (درهم مغربي/م³):</label>
          <input id="aggregatePrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="160" placeholder="مثال: 160" aria-label="سعر الحصى">
        </div>
		
		
		
		

        <div>
          <label class="block text-sm font-medium" for="laborPrice">سعر اليد العاملة (درهم مغربي/م²):</label>
          <input id="laborPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="240" placeholder="مثال: 240" aria-label="سعر اليد العاملة لكل متر مربع">
        </div>
		
		
		
		
		
        <div>
          <label class="block text-sm font-medium" for="combinedMaterialPrice">سعر الوردي والبودر والشبكة (درهم مغربي/م²):</label>
          <input id="combinedMaterialPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="85" placeholder="مثال: 85" aria-label="سعر الوردي والبودر والشبكة لكل متر مربع">
        </div>
        <div>
          <label class="block text-sm font-medium" for="stonePrice">سعر الحجر للبلوكاج (درهم مغربي/فياج):</label>
          <input id="stonePrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="3500" placeholder="مثال: 3500" aria-label="سعر الحجر للبلوكاج لكل فياج">
        </div>
        <div>
          <label class="block text-sm font-medium" for="sacksPrice"> </label>
          <input id="sacksPrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="3500" placeholder="مثال: 3500" aria-label="سعر الكياس لكل فياج"  style="display: none;" >
        </div>


	  <div>
    <label class="block text-sm font-medium" for="sandFayagePrice"> </label>
    <input id="sandFayagePrice" type="number" min="0" step="0.1" class="mt-1 p-2 w-full border rounded" value="6000" placeholder="مثال: 6000" aria-label="سعر الرمل لكل فياج" style="display: none;">
</div>


      </div>



      <div class="flex justify-center gap-4 mt-6">
        <button onclick="calculateCost()" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">احسب التكلفة الآن</button>
 
 <!--      <button onclick="resetForm()" class="w-full bg-gray-600 text-white p-2 rounded hover:bg-gray-700">إعادة تعيين</button>  -->

    </div>
    </div>

    <!-- Cost Output -->
    <div id="costOutput" class="bg-white p-6 rounded-lg shadow-md mb-6 hidden">
	
	
	<h3 style="color: #004aad; font-size: 20px; text-align: center;">
  
  يمكنك إعادة حساب تكلفة المنزل مرة أخرى إذا تغيرت أسعار مواد البناء بناءً على الأسعار الواردة في الجدول أعلاه.
  </h3>
  <h3 style="color: #004aad; font-size: 20px; text-align: center;">
   يمكنك تعديل "الكمية" حسب المطلوب، مع سعر الوحدة لكل مادة.
   يمكنك تعديل تكلفة الحفر (مثلاً من 35 إلى 50) وسيتم تحديث السعر الإجمالي تلقائيًا.
  </h3>
    <h3 style="color: #004aad; font-size: 20px; text-align: center;">
	
وفي النهاية يمكنك رؤية السعر والملخص لكل مادة لكل المنزل بالكامل، ويمكنك أيضًا طباعة التقرير بصيغة PDF أو Excel 
  </h3>

	
      <h2 class="text-xl font-semibold mb-4 text-blue-700">تفاصيل التكلفة</h2>
      <table class="w-full border-collapse mb-6">
        <thead>
          <tr class="bg-blue-600 text-white">
            <th class="border p-2">المادة</th>
            <th class="border p-2">المرحلة</th>
            <th class="border p-2">الكمية</th>
            <th class="border p-2">التكلفة لكل وحدة (درهم مغربي)</th>
            <th class="border p-2">التكلفة (درهم مغربي)</th>
            <th class="border p-2">المساحة المغطاة (م²)</th>
          </tr>
        </thead>
        <tbody id="costTableBody"></tbody>
      </table>
      <h3 class="text-lg font-semibold mt-4 text-blue-800">الإجمالي: <span id="totalCost">0</span> درهم مغربي</h3>

      <!-- Summary by Product -->
      <h2 class="text-xl font-semibold mt-6 mb-4 text-blue-700">ملخص التكلفة حسب المادة</h2>
      <table class="w-full border-collapse">
        <thead>
          <tr class="bg-blue-200">
            <th class="border p-2">المادة</th>
            <th class="border p-2">إجمالي الكمية</th>
            <th class="border p-2">إجمالي التكلفة (درهم مغربي)</th>
            <th class="border p-2">النسبة المئوية (%)</th>
          </tr>
        </thead>
        <tbody id="summaryTableBody"></tbody>
      </table>
    </div>

    <!-- Export Buttons -->
    <div class="flex justify-center gap-4 mb-6">
      <button onclick="exportToPDF()" class="bg-green-600 text-white p-2 rounded hover:bg-green-700">📄 تصدير إلى PDF</button>
      <button onclick="exportToExcel()" class="bg-blue-600 text-white p-2 rounded hover:bg-blue-700">تصدير الجداول إلى Excel</button>
    </div>
  </div>

 
 
 


 <script>
    let costData = [];

    function validateInputs(inputs) {
      const errors = [];
      const requiredInputs = { ...inputs };
      delete requiredInputs.landLength;
      delete requiredInputs.landWidth;
      delete requiredInputs.buildLength;
      delete requiredInputs.buildWidth;
      for (const [id, value] of Object.entries(requiredInputs)) {
        if (isNaN(value) || value <= 0) {
          errors.push(`يرجى إدخال قيمة صحيحة وموجبة لـ ${document.querySelector(`label[for="${id}"]`).textContent}`);
        }
      }
      return errors;
    }

    function showError(message) {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = message;
      errorDiv.classList.remove('hidden');
    }

    function clearError() {
      const errorDiv = document.getElementById('errorMessage');
      errorDiv.textContent = '';
      errorDiv.classList.add('hidden');
    }

    function resetForm() {
      const inputs = document.querySelectorAll('input[type="number"], input[type="checkbox"]');
      inputs.forEach(input => {
        if (input.type === 'number') {
          input.value = input.id === 'numFloors' ? 1 : input.id === 'semelleCount' ? 16 : input.id === 'betonPrice' ? 600 : 
                        input.id === 'b15Price' ? 600 : input.id === 'ironPrice' ? 9.5 : input.id === 'cementPrice' ? 82 : 
                        input.id === 'excavationPrice' ? 35 : input.id === 'gravelPrice' ? 200 : input.id === 'brickPrice' ? 6.5 : 
                        input.id === 'sandPrice' ? 240 : input.id === 'aggregatePrice' ? 160 : input.id === 'laborPrice' ? 100 : 
                        input.id === 'combinedMaterialPrice' ? 85 : input.id === 'stonePrice' ? 3500 : input.id === 'sacksPrice' ? 3500 : 
                        input.id === 'sandFayagePrice' ? 6000 : input.id === 'landWidth' ? 12 : input.id === 'buildWidth' ? 12 : '';
        } else if (input.type === 'checkbox') {
          input.checked = input.id === 'hasBasement';
        }
      });
      document.getElementById('costOutput').classList.add('hidden');
      clearError();
    }

    function updateTables() {
      const totalCost = costData.reduce((sum, item) => sum + (item.stage.includes('للمعلومات') ? 0 : item.totalCost), 0);
      const costTableBody = document.getElementById('costTableBody');
      costTableBody.innerHTML = costData.map((item, idx) => `
        <tr class="${item.material.startsWith('الحديد ') ? 'bg-gray-100' : item.material === 'الوردي والبودر والشبكة' || item.material === 'الحجر (للبلوكاج)' || item.material === 'الكياس' || item.material === 'الرمل' ? 'bg-blue-100' : idx % 2 === 0 ? 'bg-gray-50' : 'bg-white'}">
          <td class="border p-2">${item.material}</td>
          <td class="border p-2">${item.stage}</td>
          <td class="border p-2"><input type="number" value="${item.quantity}" step="0.1" min="0" onchange="updateQuantity(${idx}, this.value)" class="w-full p-1 border rounded" aria-label="الكمية لـ ${item.material}"></td>
          <td class="border p-2">${item.coveredArea.toFixed(2)}</td>
          <td class="border p-2"><input type="number" value="${item.unitPrice}" step="0.1" min="0" onchange="updateUnitPrice(${idx}, this.value)" class="w-full p-1 border rounded" aria-label="سعر الوحدة لـ ${item.material}"></td>
          <td class="border p-2">${item.totalCost.toFixed(2)}</td>
          <td class="border p-2">${item.costPerM2.toFixed(2)}</td>
        </tr>
      `).join('');
      const materials = [
        'حفر الأساسات',
        'الحديد',
        'البيتون',
        'خرسانة النظافة B15',
        'الأسمنت',
        'حصى الفياج',
        'الطوب',
        'رمل البناء',
        'الحصى',
        'اليد العاملة',
        'الوردي والبودر والشبكة',
        'الحجر (للبلوكاج)',
        'الكياس',
        'الرمل'
      ];
      const summaryData = materials.map(material => {
        const items = costData.filter(item => (item.material === material || item.material.startsWith(material + ' ')) && !item.stage.includes('للمعلومات'));
        const totalQuantity = items.reduce((sum, item) => sum + parseFloat(item.quantity), 0);
        const totalCostItem = items.reduce((sum, item) => sum + item.totalCost, 0);
        return {
          material,
          quantity: totalQuantity.toFixed(2),
          unit: items.length > 0 ? items[0].unit : '',
          totalCost: totalCostItem,
          percentage: totalCost > 0 ? (totalCostItem / totalCost * 100).toFixed(2) : 0
        };
      }).filter(item => item.quantity > 0);
      const summaryTableBody = document.getElementById('summaryTableBody');
      summaryTableBody.innerHTML = summaryData.map(item => `
        <tr class="${item.material === 'الوردي والبودر والشبكة' || item.material === 'الحجر (للبلوكاج)' || item.material === 'الكياس' || item.material === 'الرمل' ? 'bg-blue-100' : ''}">
          <td class="border p-2">${item.material}</td>
          <td class="border p-2">${item.quantity} ${item.unit}</td>
          <td class="border p-2">${item.totalCost.toFixed(2)}</td>
          <td class="border p-2">${item.percentage}%</td>
        </tr>
      `).join('');
      document.getElementById('totalCost').textContent = totalCost.toFixed(2);
    }

    function calculateCost() {
      const inputs = {
        landLength: parseFloat(document.getElementById('landLength').value),
        landWidth: parseFloat(document.getElementById('landWidth').value),
        buildLength: parseFloat(document.getElementById('buildLength').value),
        buildWidth: parseFloat(document.getElementById('buildWidth').value),
        numFloors: parseInt(document.getElementById('numFloors').value),
        semelleCount: parseInt(document.getElementById('semelleCount').value),
        betonPrice: parseFloat(document.getElementById('betonPrice').value),
        b15Price: parseFloat(document.getElementById('b15Price').value),
        ironPrice: parseFloat(document.getElementById('ironPrice').value),
        cementPrice: parseFloat(document.getElementById('cementPrice').value),
        excavationPrice: parseFloat(document.getElementById('excavationPrice').value),
        gravelPrice: parseFloat(document.getElementById('gravelPrice').value),
        brickPrice: parseFloat(document.getElementById('brickPrice').value),
        sandPrice: parseFloat(document.getElementById('sandPrice').value),
        aggregatePrice: parseFloat(document.getElementById('aggregatePrice').value),
        laborPrice: parseFloat(document.getElementById('laborPrice').value),
        combinedMaterialPrice: parseFloat(document.getElementById('combinedMaterialPrice').value),
        stonePrice: parseFloat(document.getElementById('stonePrice').value),
        sacksPrice: parseFloat(document.getElementById('sacksPrice').value),
        sandFayagePrice: parseFloat(document.getElementById('sandFayagePrice').value)
      };

      const errors = validateInputs(inputs);
      if (errors.length > 0) {
        showError(errors.join('\n'));
        return;
      }
      clearError();

      const landLength = isNaN(inputs.landLength) || inputs.landLength <= 0 ? 10 : inputs.landLength;
      const landWidth = isNaN(inputs.landWidth) || inputs.landWidth <= 0 ? 12 : inputs.landWidth;
      const buildLength = isNaN(inputs.buildLength) || inputs.buildLength <= 0 ? 12 : inputs.buildLength;
      const buildWidth = isNaN(inputs.buildWidth) || inputs.buildWidth <= 0 ? 12 : inputs.buildWidth;
      const numFloors = inputs.numFloors || 1;
      const hasBasement = document.getElementById('hasBasement').checked;
      const semelleCount = inputs.semelleCount || 16;
      const semelleLength = 1.5;
      const semelleWidth = 1.5;
      const semelleHeight = 0.3;
      const betonPrice = inputs.betonPrice || 600;
      const b15Price = inputs.b15Price || 600;
      const ironPrice = inputs.ironPrice || 9.5;
      const cementPrice = inputs.cementPrice || 82;
      const excavationPrice = inputs.excavationPrice || 35;
      const gravelPrice = inputs.gravelPrice || 200;
      const brickPrice = inputs.brickPrice || 6.5;
      const sandPrice = inputs.sandPrice || 240;
      const aggregatePrice = inputs.aggregatePrice || 160;
      const laborPrice = inputs.laborPrice || 100;
      const combinedMaterialPrice = inputs.combinedMaterialPrice || 85;
      const stonePrice = inputs.stonePrice || 3500;
      const sacksPrice = inputs.sacksPrice || 3500;
      const sandFayagePrice = inputs.sandFayagePrice || 6000;

      const baseBuildArea = buildLength * buildWidth;
      const upperFloorArea = buildLength * (buildWidth + 1);
      const landArea = landLength * landWidth;
      const projectionArea = 10;

      const floorAreas = [baseBuildArea];
      let totalArea = baseBuildArea;
      for (let i = 1; i <= numFloors; i++) {
        floorAreas.push(upperFloorArea);
        totalArea += upperFloorArea;
      }
      const terraceArea = baseBuildArea * 0.4;
      totalArea += terraceArea;
      if (hasBasement) totalArea += (baseBuildArea + projectionArea);

      costData = [];

      const excavationVolume = baseBuildArea * 3;
      const excavationCost = excavationVolume * excavationPrice;
      costData.push({
        material: 'حفر الأساسات',
        stage: 'الأساسات',
        quantity: excavationVolume.toFixed(2),
        unit: 'م³',
        unitPrice: excavationPrice,
        coveredArea: baseBuildArea,
        totalCost: excavationCost,
        costPerM2: excavationCost / baseBuildArea
      });

//      const mainIronPerM2 = 7500 / 120;
      let mainIronPerM2;



if (baseBuildArea < 80) {
    mainIronPerM2 = 5000 / 120;
} else if (baseBuildArea >= 80 && baseBuildArea < 90) {
    mainIronPerM2 = 5000 / 120;
} else if (baseBuildArea >= 90 && baseBuildArea < 100) {
    mainIronPerM2 = 5500 / 120;
} else if (baseBuildArea >= 100 && baseBuildArea < 110) {
    mainIronPerM2 = 6000 / 120;
} else if (baseBuildArea >= 110 && baseBuildArea < 120) {
    mainIronPerM2 = 6500 / 120;
} else if (baseBuildArea >= 120 && baseBuildArea < 130) {
    mainIronPerM2 = 7000 / 120;
} else if (baseBuildArea >= 130 && baseBuildArea < 140) {
    mainIronPerM2 = 7500 / 120;
} else if (baseBuildArea >= 140 && baseBuildArea < 150) {
    mainIronPerM2 = 8000 / 120;
} else if (baseBuildArea >= 180 && baseBuildArea <= 300) {
    mainIronPerM2 = 8500 / 120;
}

console.log(mainIronPerM2);


	  
	  
      let mainIronKg = mainIronPerM2 * baseBuildArea;
      let basementIronKg = 0;
      let totalIronKg = mainIronKg;
      if (hasBasement) {
        basementIronKg = (2250 * baseBuildArea) / 120;
        totalIronKg += basementIronKg;
      }
      costData.push({
        material: 'الحديد',
        stage: 'كامل المشروع (بدون قبو)',
        quantity: mainIronKg.toFixed(2),
        unit: 'كجم',
        unitPrice: ironPrice,
        coveredArea: totalArea,
        totalCost: mainIronKg * ironPrice,
        costPerM2: (mainIronKg * ironPrice) / totalArea
      });
      if (hasBasement) {
        costData.push({
          material: 'الحديد',
          stage: 'القبو',
          quantity: basementIronKg.toFixed(2),
          unit: 'كجم',
          unitPrice: ironPrice,
          coveredArea: baseBuildArea + projectionArea,
          totalCost: basementIronKg * ironPrice,
          costPerM2: (basementIronKg * ironPrice) / (baseBuildArea + projectionArea)
        });
      }

      const ironSizes = [
        { size: '6 مم', quantityKg: 1.50 },
        { size: '8 مم', quantityKg: 0.20 },
        { size: '10 مم', quantityKg: 3.50 },
        { size: '14 مم', quantityKg: 0.30 }
      ];
      ironSizes.forEach(({ size, quantityKg }) => {
        const scaledQuantity = (quantityKg * baseBuildArea / 120).toFixed(2);
        costData.push({
          material: `الحديد ${size}`,
          stage: 'الطبلة (للمعلومات)',
          quantity: scaledQuantity,
          unit: 'كجم',
          unitPrice: ironPrice,
          coveredArea: baseBuildArea,
          totalCost: 0,
          costPerM2: 0
        });
      });

      const semelleBeton = Math.ceil(semelleCount * 0.675);
      const dalleBeton = Math.ceil(baseBuildArea * 0.12);
      const terraceBeton = Math.ceil(terraceArea * 0.12);
      let basementBeton = 0;
      if (hasBasement) {
        basementBeton = Math.ceil((baseBuildArea + projectionArea) * 0.12);
      }
      costData.push({
        material: 'البيتون',
        stage: 'الأساسات (Semelle)',
        quantity: semelleBeton.toFixed(2),
        unit: 'م³',
        unitPrice: betonPrice,
        coveredArea: baseBuildArea,
        totalCost: semelleBeton * betonPrice,
        costPerM2: (semelleBeton * betonPrice) / baseBuildArea
      });
      costData.push({
        material: 'البيتون',
        stage: 'الأساسات (Dalle)',
        quantity: dalleBeton.toFixed(2),
        unit: 'م³',
        unitPrice: betonPrice,
        coveredArea: baseBuildArea,
        totalCost: dalleBeton * betonPrice,
        costPerM2: (dalleBeton * betonPrice) / baseBuildArea
      });
      const rdcBeton = Math.ceil(baseBuildArea * 0.12);
      costData.push({
        material: 'البيتون',
        stage: 'الطابق الأرضي (RDC)',
        quantity: rdcBeton.toFixed(2),
        unit: 'م³',
        unitPrice: betonPrice,
        coveredArea: baseBuildArea,
        totalCost: rdcBeton * betonPrice,
        costPerM2: (rdcBeton * betonPrice) / baseBuildArea
      });
      for (let i = 1; i <= numFloors; i++) {
        const floorBeton = Math.ceil(upperFloorArea * 0.12);
        costData.push({
          material: 'البيتون',
          stage: `الطابق ${i} (R+${i})`,
          quantity: floorBeton.toFixed(2),
          unit: 'م³',
          unitPrice: betonPrice,
          coveredArea: upperFloorArea,
          totalCost: floorBeton * betonPrice,
          costPerM2: (floorBeton * betonPrice) / upperFloorArea
        });
      }
      costData.push({
        material: 'البيتون',
        stage: 'السطح (Terrace)',
        quantity: terraceBeton.toFixed(2),
        unit: 'م³',
        unitPrice: betonPrice,
        coveredArea: terraceArea,
        totalCost: terraceBeton * betonPrice,
        costPerM2: (terraceBeton * betonPrice) / terraceArea
      });
      if (hasBasement) {
        costData.push({
          material: 'البيتون',
          stage: 'القبو',
          quantity: basementBeton.toFixed(2),
          unit: 'م³',
          unitPrice: betonPrice,
          coveredArea: baseBuildArea + projectionArea,
          totalCost: basementBeton * betonPrice,
          costPerM2: (basementBeton * betonPrice) / (baseBuildArea + projectionArea)
        });
      }

      const b15Beton = Math.ceil(semelleCount === 16 ? 11 : (11 * (semelleCount / 16)));
      const b15Cost = b15Beton * b15Price;
      costData.push({
        material: 'خرسانة النظافة B15',
        stage: 'الطبلة',
        quantity: b15Beton.toFixed(2),
        unit: 'م³',
        unitPrice: b15Price,
        coveredArea: baseBuildArea,
        totalCost: b15Cost,
        costPerM2: b15Cost / baseBuildArea
      });

      const cementPerStage = {
        'Fondation': 92,
        'RDC': 85,
        'R+1': 85,
        'R+2': 85,
        'R+3': 85,
        'R+4': 85,
         'Terrace': 20,
        'Basement': 68
      };
      let totalCementBags = cementPerStage['Fondation'] * (baseBuildArea / 120);
      totalCementBags += cementPerStage['RDC'] * (baseBuildArea / 120);
      for (let i = 1; i <= numFloors; i++) {
        totalCementBags += cementPerStage[`R+${i}`] * (upperFloorArea / 120);
      }
      totalCementBags += cementPerStage['Terrace'] * (baseBuildArea / 120);
      if (hasBasement) totalCementBags += cementPerStage['Basement'] * (baseBuildArea / 120);
      costData.push({
        material: 'الأسمنت',
        stage: 'الأساسات',
        quantity: (cementPerStage['Fondation'] * baseBuildArea / 120).toFixed(2),
        unit: 'خنشة',
        unitPrice: cementPrice,
        coveredArea: baseBuildArea,
        totalCost: (cementPerStage['Fondation'] * baseBuildArea / 120) * cementPrice,
        costPerM2: ((cementPerStage['Fondation'] * baseBuildArea / 120) * cementPrice) / baseBuildArea
      });
      costData.push({
        material: 'الأسمنت',
        stage: 'الطابق الأرضي (RDC)',
        quantity: (cementPerStage['RDC'] * baseBuildArea / 120).toFixed(2),
        unit: 'خنشة',
        unitPrice: cementPrice,
        coveredArea: baseBuildArea,
        totalCost: (cementPerStage['RDC'] * baseBuildArea / 120) * cementPrice,
        costPerM2: ((cementPerStage['RDC'] * baseBuildArea / 120) * cementPrice) / baseBuildArea
      });
      for (let i = 1; i <= numFloors; i++) {
        costData.push({
          material: 'الأسمنت',
          stage: `الطابق ${i} (R+${i})`,
          quantity: (cementPerStage[`R+${i}`] * upperFloorArea / 120).toFixed(2),
          unit: 'خنشة',
          unitPrice: cementPrice,
          coveredArea: upperFloorArea,
          totalCost: (cementPerStage[`R+${i}`] * upperFloorArea / 120) * cementPrice,
          costPerM2: ((cementPerStage[`R+${i}`] * upperFloorArea / 120) * cementPrice) / upperFloorArea
        });
      }
      costData.push({
        material: 'الأسمنت',
        stage: 'السطح (Terrace)',
        quantity: (cementPerStage['Terrace'] * baseBuildArea / 120).toFixed(2),
        unit: 'خنشة',
        unitPrice: cementPrice,
        coveredArea: terraceArea,
        totalCost: (cementPerStage['Terrace'] * baseBuildArea / 120) * cementPrice,
        costPerM2: ((cementPerStage['Terrace'] * baseBuildArea / 120) * cementPrice) / terraceArea
      });
      if (hasBasement) {
        costData.push({
          material: 'الأسمنت',
          stage: 'القبو',
          quantity: (cementPerStage['Basement'] * baseBuildArea / 120).toFixed(2),
          unit: 'خنشة',
          unitPrice: cementPrice,
          coveredArea: baseBuildArea + projectionArea,
          totalCost: (cementPerStage['Basement'] * baseBuildArea / 120) * cementPrice,
          costPerM2: ((cementPerStage['Basement'] * baseBuildArea / 120) * cementPrice) / (baseBuildArea + projectionArea)
        });
      }

      const gravelVolume = (25 * baseBuildArea) / 120;
      const gravelCost = gravelVolume * gravelPrice;
      costData.push({
        material: 'حصى الفياج',
        stage: 'الأساسات',
        quantity: gravelVolume.toFixed(2),
        unit: 'م³',
        unitPrice: gravelPrice,
        coveredArea: baseBuildArea,
        totalCost: gravelCost,
        costPerM2: gravelCost / baseBuildArea
      });

      const mainBricks = (4000 * baseBuildArea) / 120;
      const partitionBricks = (5000 * baseBuildArea) / 120;
      const totalBricks = mainBricks + partitionBricks;
      const brickCost = totalBricks * brickPrice;
      costData.push({
        material: 'الطوب',
        stage: 'كامل المشروع',
        quantity: totalBricks.toFixed(2),
        unit: 'حبة',
        unitPrice: brickPrice,
        coveredArea: totalArea,
        totalCost: brickCost,
        costPerM2: brickCost / totalArea
      });

      const sandVolume = (25 * baseBuildArea) / 120;
      const sandCost = sandVolume * sandPrice;
      costData.push({
        material: 'رمل البناء',
        stage: 'كامل المشروع',
        quantity: sandVolume.toFixed(2),
        unit: 'م³',
        unitPrice: sandPrice,
        coveredArea: totalArea,
        totalCost: sandCost,
        costPerM2: sandCost / totalArea
      });

      const aggregateVolume = (25 * baseBuildArea) / 120;
      const aggregateCost = aggregateVolume * aggregatePrice;
      costData.push({
        material: 'الحصى',
        stage: 'كامل المشروع',
        quantity: aggregateVolume.toFixed(2),
        unit: 'م³',
        unitPrice: aggregatePrice,
        coveredArea: totalArea,
        totalCost: aggregateCost,
        costPerM2: aggregateCost / totalArea
      });

      const laborPerStage = 100;
      let totalLaborCost = laborPerStage * baseBuildArea;
      totalLaborCost += laborPerStage * baseBuildArea;
      for (let i = 1; i <= numFloors; i++) {
        totalLaborCost += laborPerStage * upperFloorArea;
      }
      totalLaborCost += laborPerStage * terraceArea;
      if (hasBasement) totalLaborCost += laborPerStage * (baseBuildArea + projectionArea);
      totalLaborCost *= laborPrice / 100;
      costData.push({
        material: 'اليد العاملة',
        stage: 'الأساسات',
        quantity: baseBuildArea.toFixed(2),
        unit: 'م²',
        unitPrice: laborPrice,
        coveredArea: baseBuildArea,
        totalCost: laborPerStage * baseBuildArea * (laborPrice / 100),
        costPerM2: laborPerStage * (laborPrice / 100)
      });
      costData.push({
        material: 'اليد العاملة',
        stage: 'الطابق الأرضي (RDC)',
        quantity: baseBuildArea.toFixed(2),
        unit: 'م²',
        unitPrice: laborPrice,
        coveredArea: baseBuildArea,
        totalCost: laborPerStage * baseBuildArea * (laborPrice / 100),
        costPerM2: laborPerStage * (laborPrice / 100)
      });
      for (let i = 1; i <= numFloors; i++) {
        costData.push({
          material: 'اليد العاملة',
          stage: `الطابق ${i} (R+${i})`,
          quantity: upperFloorArea.toFixed(2),
          unit: 'م²',
          unitPrice: laborPrice,
          coveredArea: upperFloorArea,
          totalCost: laborPerStage * upperFloorArea * (laborPrice / 100),
          costPerM2: laborPerStage * (laborPrice / 100)
        });
      }
      costData.push({
        material: 'اليد العاملة',
        stage: 'السطح (Terrace)',
        quantity: terraceArea.toFixed(2),
        unit: 'م²',
        unitPrice: laborPrice,
        coveredArea: terraceArea,
        totalCost: laborPerStage * terraceArea * (laborPrice / 100),
        costPerM2: laborPerStage * (laborPrice / 100)
      });
      if (hasBasement) {
        costData.push({
          material: 'اليد العاملة',
          stage: 'القبو',
          quantity: (baseBuildArea + projectionArea).toFixed(2),
          unit: 'م²',
          unitPrice: laborPrice,
          coveredArea: baseBuildArea + projectionArea,
          totalCost: laborPerStage * (baseBuildArea + projectionArea) * (laborPrice / 100),
          costPerM2: laborPerStage * (laborPrice / 100)
        });
      }

      // Combined Material: الوردي والبودر والشبكة
      costData.push({
        material: 'الوردي والبودر والشبكة',
        stage: 'كامل المشروع',
        quantity: totalArea.toFixed(2),
        unit: 'م²',
        unitPrice: combinedMaterialPrice,
        coveredArea: totalArea,
        totalCost: totalArea * combinedMaterialPrice,
        costPerM2: combinedMaterialPrice
      });

      // New Materials: الحجر (للبلوكاج), الكياس, الرمل
      const fayageQuantity = (baseBuildArea / 25).toFixed(2);
      costData.push({
        material: 'الحجر (للبلوكاج)',
        stage: 'كامل المشروع',
        quantity: fayageQuantity,
        unit: 'فياج',
        unitPrice: stonePrice,
        coveredArea: baseBuildArea,
        totalCost: fayageQuantity * stonePrice,
        costPerM2: (fayageQuantity * stonePrice) / baseBuildArea
      });
      costData.push({
        material: 'الكياس',
        stage: 'كامل المشروع',
        quantity: fayageQuantity,
        unit: 'فياج',
        unitPrice: sacksPrice,
        coveredArea: baseBuildArea,
        totalCost: fayageQuantity * sacksPrice,
        costPerM2: (fayageQuantity * sacksPrice) / baseBuildArea
      });
      costData.push({
        material: 'الرمل',
        stage: 'كامل المشروع',
        quantity: fayageQuantity,
        unit: 'فياج',
        unitPrice: sandFayagePrice,
        coveredArea: baseBuildArea,
        totalCost: fayageQuantity * sandFayagePrice,
        costPerM2: (fayageQuantity * sandFayagePrice) / baseBuildArea
      });

      document.getElementById('costOutput').classList.remove('hidden');
      updateTables();
    }

    function updateUnitPrice(index, newPrice) {
      const price = parseFloat(newPrice);
      if (isNaN(price) || price < 0) {
        showError('يرجى إدخال سعر وحدة صالح وموجب');
        return;
      }
      costData[index].unitPrice = price;
      costData[index].totalCost = parseFloat(costData[index].quantity) * costData[index].unitPrice;
      costData[index].costPerM2 = costData[index].coveredArea > 0 ? costData[index].totalCost / costData[index].coveredArea : 0;
      if (costData[index].stage.includes('للمعلومات')) {
        costData[index].totalCost = 0;
        costData[index].costPerM2 = 0;
      }
      clearError();
      updateTables();
    }

    function updateQuantity(index, newQuantity) {
      const quantity = parseFloat(newQuantity);
      if (isNaN(quantity) || quantity < 0) {
        showError('يرجى إدخال كمية صالحة وموجبة');
        return;
      }
      costData[index].quantity = quantity.toFixed(2);
      costData[index].totalCost = parseFloat(costData[index].quantity) * costData[index].unitPrice;
      costData[index].costPerM2 = costData[index].coveredArea > 0 ? costData[index].totalCost / costData[index].coveredArea : 0;
      if (costData[index].stage.includes('للمعلومات')) {
        costData[index].totalCost = 0;
        costData[index].costPerM2 = 0;
      }
      clearError();
      updateTables();
    }

    function exportToPDF() {
      const element = document.getElementById('costOutput');
      const inputsSummary = `
        <div class="mb-4">
          <h2 class="text-xl font-semibold">ملخص المدخلات</h2>
          <p>طول الأرض: ${document.getElementById('landLength').value || 10} م</p>
          <p>عرض الأرض: ${document.getElementById('landWidth').value || 12} م</p>
          <p>طول المبنى: ${document.getElementById('buildLength').value || 12} م</p>
          <p>عرض المبنى: ${document.getElementById('buildWidth').value || 12} م</p>
          <p>عدد الطوابق: ${document.getElementById('numFloors').value || 1}</p>
          <p>وجود قبو: ${document.getElementById('hasBasement').checked ? 'نعم' : 'لا'}</p>
        </div>
      `;
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = inputsSummary + element.outerHTML;
      html2pdf().from(tempDiv).save('cost_estimation.pdf');
    }

    function exportToExcel() {
      const costTable = document.getElementById('costTableBody');
      const summaryTable = document.getElementById('summaryTableBody');
      const wb = XLSX.utils.book_new();
      const costRows = costTable.getElementsByTagName('tr');
      const costData = [['المادة', 'المرحلة', 'الكمية', 'المساحة المغطاة (م²)', 'التكلفة لكل وحدة (درهم مغربي)', 'التكلفة (درهم مغربي)', 'التكلفة لكل م² (درهم مغربي)']];
      for (let row of costRows) {
        const cells = row.getElementsByTagName('td');
        costData.push([
          cells[0].textContent,
          cells[1].textContent,
          cells[2].getElementsByTagName('input')[0].value,
          cells[3].textContent,
          cells[4].getElementsByTagName('input')[0].value,
          cells[5].textContent,
          cells[6].textContent
        ]);
      }
      const costWs = XLSX.utils.aoa_to_sheet(costData);
      XLSX.utils.book_append_sheet(wb, costWs, 'Detailed Cost');
      const summaryRows = summaryTable.getElementsByTagName('tr');
      const summaryData = [['المادة', 'إجمالي الكمية', 'إجمالي التكلفة (درهم مغربي)', 'النسبة المئوية (%)']];
      for (let row of summaryRows) {
        const cells = row.getElementsByTagName('td');
        summaryData.push([
          cells[0].textContent,
          cells[1].textContent,
          cells[2].textContent,
          cells[3].textContent
        ]);
      }
      const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
      XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary by Product');
      XLSX.writeFile(wb, 'cost_estimation.xlsx');
    }
  </script>

  
</body>
</html>

